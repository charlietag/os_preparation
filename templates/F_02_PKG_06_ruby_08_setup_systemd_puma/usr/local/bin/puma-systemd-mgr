#!/bin/bash

# ------------------------------------
# Source script lib
# ------------------------------------
. "$(readlink -m $0)_template/lib/load.sh"

check_nginx_conf_exists
check_required_dependencies
# ------------------------------------
# Main
# ------------------------------------
#
# Ref. https://tldp.org/LDP/abs/html/internal.html#GETOPTSX
# colon ':' from beginning, such as ':t' , means silent mode
# (NO warning message: illegal option --)
# colon ':' at the end, such as 'i:' , means comes with value (OPTARG)

# Silent mode
#while getopts ':tpredi:ahlg' argv
CHOSEN_OPTIONS=""

while getopts 'tpredi:algh' argv
do
  case $argv in
    t)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},t"
      ;;
    p)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},p"
      ;;
    r)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},r"
      ;;
    e)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},e"
      ;;
    d)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},d"
      ;;
    i)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},i"
      CHOSEN_PUMA_NAMES="${OPTARG}"
      ;;
    a)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},a"
      # ALL_PUMA_CHOSEN=1
      ;;
    l)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},l"
      # list_puma_services
      ;;
    g)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},g"
      # generate_systemd_config
      ;;
    h)
      CHOSEN_OPTIONS="${CHOSEN_OPTIONS},h"
      # usage
      # exit
      ;;
  esac
done

check_option "${CHOSEN_OPTIONS}" "${CHOSEN_PUMA_NAMES}"
# run_option   "${CHOSEN_OPTIONS}" "${CHOSEN_PUMA_NAMES}"

# ----------------------------------------------------------------------------------------------------------
# no options were passed with getopts
# ----------------------------------------------------------------------------------------------------------
# Ref. https://unix.stackexchange.com/questions/50563/how-can-i-detect-that-no-options-were-passed-with-getopts
# echo ${OPTIND}
if [[ ${OPTIND} -eq 1 ]]; then
  echo "No options were passed !"
  show_help_and_exit
fi
